import tkinter as tk
import sys
from io import StringIO
from t13_core import T13Engine

ai = T13Engine(user_name="Erfan")
options = ["Continue Project", "Take a Break", "Postpone"]

# Redirect stdout to Text widget
class RedirectText:
    def __init__(self, widget):
        self.widget = widget

    def write(self, string):
        self.widget.insert(tk.END, string)
        self.widget.see(tk.END)

    def flush(self):
        pass

def run_with_output(fn):
    output.delete(1.0, tk.END)
    sys.stdout = RedirectText(output)
    try:
        fn()
    except Exception as e:
        print(f"⚠️ Error: {e}")
    finally:
        sys.stdout = sys.__stdout__

# Get user-input emotional values
def get_user_feelings():
    return {
        "joy": int(entry_joy.get() or 5),
        "stress": int(entry_stress.get() or 5),
        "hope": int(entry_hope.get() or 5),
        "fear": int(entry_fear.get() or 5),
        "energy": int(entry_energy.get() or 5)
    }

def run_custom_all():
    feelings = get_user_feelings()
    run_with_output(lambda: ai.run_all(feelings, options))

# GUI setup
root = tk.Tk()
root.title("T13.3 AI Core Interface")
root.geometry("700x750")
root.configure(bg="#111")

title = tk.Label(root, text="💠 T13.3 AI Core Interface – by Erfan", font=("Arial", 16, "bold"), bg="#111", fg="#00FFD1")
title.pack(pady=10)

# Emotion input fields
form_frame = tk.Frame(root, bg="#111")
form_frame.pack(pady=10)

tk.Label(form_frame, text="Joy", fg="white", bg="#111").grid(row=0, column=0)
tk.Label(form_frame, text="Stress", fg="white", bg="#111").grid(row=0, column=1)
tk.Label(form_frame, text="Hope", fg="white", bg="#111").grid(row=0, column=2)
tk.Label(form_frame, text="Fear", fg="white", bg="#111").grid(row=0, column=3)
tk.Label(form_frame, text="Energy", fg="white", bg="#111").grid(row=0, column=4)

entry_joy = tk.Entry(form_frame, width=5)
entry_stress = tk.Entry(form_frame, width=5)
entry_hope = tk.Entry(form_frame, width=5)
entry_fear = tk.Entry(form_frame, width=5)
entry_energy = tk.Entry(form_frame, width=5)

entry_joy.grid(row=1, column=0)
entry_stress.grid(row=1, column=1)
entry_hope.grid(row=1, column=2)
entry_fear.grid(row=1, column=3)
entry_energy.grid(row=1, column=4)

tk.Button(root, text="🚀 Run All with My Emotions", command=run_custom_all, bg="#006699", fg="white", width=40).pack(pady=5)

# Feature buttons
btn_frame = tk.Frame(root, bg="#111")
btn_frame.pack()

btns = [
    ("🧠 Memory", lambda: run_with_output(ai.run_memory)),
    ("📊 Emotion Analysis", lambda: run_with_output(lambda: ai.run_emotion(get_user_feelings()))),
    ("🧭 Decision Making", lambda: run_with_output(lambda: ai.run_decision(options))),
    ("🎭 Behavior Mode", lambda: run_with_output(ai.run_behavior)),
    ("🧬 Self Upgrade", lambda: run_with_output(ai.run_upgrade)),
    ("🩺 System Health", lambda: run_with_output(ai.run_health)),
    ("📈 Trend Analysis", lambda: run_with_output(ai.run_trend_analysis)),
    ("🎇 Multiverse Scenario", lambda: run_with_output(ai.run_multiverse))
]

for text, command in btns:
    tk.Button(btn_frame, text=text, command=command, width=30, bg="#222", fg="white", font=("Arial", 10)).pack(pady=3)

# Output box
output = tk.Text(root, height=25, bg="#000", fg="#0f0", font=("Consolas", 10), insertbackground="white")
output.pack(fill="both", expand=True, padx=10, pady=10)

root.mainloop()
